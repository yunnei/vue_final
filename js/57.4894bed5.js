"use strict";(self["webpackChunkvue_final"]=self["webpackChunkvue_final"]||[]).push([[57],{1630:function(e,t,s){s.d(t,{Z:function(){return u}});var a=s(6252),l=s(71);const n={class:"loading-bg"},o=(0,a._)("div",{class:"loading"},[(0,a._)("img",{src:l,alt:"shaved-ice"}),(0,a._)("span"),(0,a._)("span"),(0,a._)("span"),(0,a._)("span")],-1),d=[o];function i(e,t){return(0,a.wg)(),(0,a.iD)("div",n,d)}var r=s(3744);const c={},m=(0,r.Z)(c,[["render",i]]);var u=m},6057:function(e,t,s){s.r(t),s.d(t,{default:function(){return Ce}});var a=s(6252),l=s(3577),n=s(9963);const o={class:"container"},d=(0,a.uE)('<div class="d-flex justify-content-center text-center pt-4"><div class="step d-flex flex-column align-items-center p-4"><div class="step-num bg-dark text-white border border-secondary border-3"> 1 </div><p class="text-muted mt-2">建立訂單</p></div><div class="step d-flex flex-column align-items-center p-4"><div class="step-num bg-secondary text-dark border border-secondary border-3"> 2 </div><p class="text-muted mt-2">確認結帳</p></div><div class="d-flex flex-column align-items-center p-4"><div class="step-num bg-secondary text-dark border border-secondary border-3"> 3 </div><p class="text-muted mt-2">完成訂單</p></div></div>',1),i={class:"row"},r={class:"col-xl-8 p-4"},c={class:"p-4"},m=(0,a._)("h2",{class:"fs-4 mb-4"},"確認訂單內容",-1),u={class:"table align-middle"},p=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"商品內容"),(0,a._)("th",{class:"d-none d-md-table-cell text-end",width:"16%"}," 單價 "),(0,a._)("th",{class:"d-none d-md-table-cell text-center",width:"24%"}," 數量 "),(0,a._)("th",{class:"d-none d-md-table-cell text-end",width:"16%"}," 金額 ")])],-1),h={class:"d-flex align-items-center"},b=["src","alt"],f={class:"ms-3"},_={class:"mb-2"},g={class:"d-md-none"},y={class:"mb-2 fw-bold"},v={class:"d-flex"},x=["onClick"],k=(0,a._)("i",{class:"bi bi-dash"},null,-1),w=[k],C=["onUpdate:modelValue","onChange"],$=["onClick"],q=(0,a._)("i",{class:"bi bi-plus"},null,-1),M=[q],V={class:"d-none d-md-table-cell text-end"},U={class:"d-none d-md-table-cell text-center"},D={class:"d-md-flex p-4"},W={class:"input-group mb-3"},S=["onClick"],Z=(0,a._)("i",{class:"bi bi-dash"},null,-1),z=[Z],L=["onUpdate:modelValue","onChange","onOnkeyup"],I=["onClick"],Q=(0,a._)("i",{class:"bi bi-plus"},null,-1),O=[Q],T={class:"d-none d-md-table-cell text-end"},j={class:"row flex-sm-row align-items-center flex-column-reverse"},H={class:"col-md-6"},Y={class:"input-group mb-3 d-flex align-items-center"},E=["placeholder"],F={class:"col-md-6"},P={key:0,class:"fs-5 fw-bold text-end"},K={key:1,class:"fs-5 fw-bold text-end text-success"},A={class:"text-muted fw-normal"},B=(0,a._)("br",null,null,-1),G={key:0,class:"text-muted"},J={class:"col-xl-4 my-4 p-4 bg-secondary"},N={class:"p-xl-0 p-4"},R=(0,a._)("h2",{class:"fs-4 mb-4"},"填寫收件人資料",-1),X={class:"mb-3"},ee=(0,a._)("label",{for:"name",class:"form-label"},[(0,a.Uk)(" 姓名 "),(0,a._)("span",{class:"text-danger"},"*")],-1),te={class:"mb-3"},se=(0,a._)("label",{for:"email",class:"form-label"},[(0,a.Uk)(" Email "),(0,a._)("span",{class:"text-danger"},"*")],-1),ae={class:"mb-3"},le=(0,a._)("label",{for:"tel",class:"form-label"},[(0,a.Uk)(" 電話 "),(0,a._)("span",{class:"text-danger"},"*")],-1),ne={class:"mb-3"},oe=(0,a._)("label",{for:"address",class:"form-label"},[(0,a.Uk)(" 地址 "),(0,a._)("span",{class:"text-danger"},"*")],-1),de={class:"mb-3"},ie=(0,a._)("label",{for:"message",class:"form-label"},"留言",-1),re={class:"text-center"},ce=["disabled"],me={key:1,class:"d-flex flex-column justify-content-center align-items-center text-center min-vh-50"},ue=(0,a._)("p",{class:"text-dark"},[(0,a._)("i",{class:"bi bi-exclamation-circle"}),(0,a.Uk)(" 購物車內沒有商品 ")],-1),pe=(0,a._)("a",{href:"#/products",class:"btn btn-dark mb-2",type:"button"}," 前往購物 ",-1),he=[ue,pe];function be(e,t,s,k,q,Z){const Q=(0,a.up)("Loader"),ue=(0,a.up)("Loading"),pe=(0,a.up)("Field"),be=(0,a.up)("error-message"),fe=(0,a.up)("Form"),_e=(0,a.up)("DelModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(ue,{active:q.isLoading,opacity:.8,"z-index":1e3},{default:(0,a.w5)((()=>[(0,a.Wm)(Q)])),_:1},8,["active","opacity"]),(0,a._)("div",o,[q.cart.carts.length?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[d,(0,a._)("div",i,[(0,a._)("div",r,[(0,a._)("div",c,[m,(0,a._)("table",u,[p,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(q.cart.carts,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",h,[(0,a._)("img",{src:t.product.imageUrl,alt:t.product.title,class:"w-36"},null,8,b),(0,a._)("div",f,[(0,a._)("div",_,(0,l.zw)(t.product.title),1),(0,a._)("div",g,[(0,a._)("div",y," $ "+(0,l.zw)(t.product.price),1),(0,a._)("div",v,[(0,a._)("button",{class:"btn btn-sm btn-outline-dark",type:"button",onClick:e=>Z.modifyQty("sub",t)},w,8,x),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control form-control-sm text-center border-dark w-25","onUpdate:modelValue":e=>t.qty=e,onChange:e=>Z.modifyQty("change",t)},null,40,C),[[n.nr,t.qty,void 0,{number:!0}]]),(0,a._)("button",{class:"btn btn-sm btn-outline-dark",type:"button",onClick:e=>Z.modifyQty("add",t)},M,8,$)])])])]),(0,a._)("td",V," $ "+(0,l.zw)(t.product.price),1),(0,a._)("td",U,[(0,a._)("div",D,[(0,a._)("div",W,[(0,a._)("button",{class:"btn btn-sm btn-outline-dark",type:"button",onClick:e=>Z.modifyQty("sub",t)},z,8,S),(0,a.wy)((0,a._)("input",{type:"number",class:"form-control form-control-sm text-center border-dark","onUpdate:modelValue":e=>t.qty=e,onChange:e=>Z.modifyQty("change",t),onOnkeyup:s=>e.inputLimit(t.qty)},null,40,L),[[n.nr,t.qty,void 0,{number:!0}]]),(0,a._)("button",{class:"btn btn-sm btn-outline-dark",type:"button",onClick:e=>Z.modifyQty("add",t)},O,8,I)])])]),(0,a._)("td",T," $ "+(0,l.zw)(t.total),1)])))),128))])]),(0,a._)("div",j,[(0,a._)("div",H,[(0,a._)("div",Y,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control me-2",placeholder:q.cart.final_total===q.cart.total?"請輸入優惠券代號":"已成功使用優惠券","onUpdate:modelValue":t[0]||(t[0]=e=>q.coupon=e)},null,8,E),[[n.nr,q.coupon]]),(0,a._)("button",{class:"btn btn-dark",type:"button",onClick:t[1]||(t[1]=(...e)=>Z.useCoupon&&Z.useCoupon(...e))}," 使用優惠券 ")])]),(0,a._)("div",F,[q.cart.final_total===q.cart.total?((0,a.wg)(),(0,a.iD)("p",P," 總金額：$ "+(0,l.zw)(q.cart.total),1)):((0,a.wg)(),(0,a.iD)("p",K,[(0,a._)("span",A,[(0,a._)("s",null,"總金額：$ "+(0,l.zw)(q.cart.total),1)]),B,(0,a.Uk)(" 折扣後金額：$ "+(0,l.zw)(parseInt(q.cart.final_total)),1)]))])]),q.cart.final_total===q.cart.total?((0,a.wg)(),(0,a.iD)("span",G," （可使用優惠券：冰友順啦） ")):(0,a.kq)("",!0)])]),(0,a._)("div",J,[(0,a._)("div",N,[R,(0,a.Wm)(fe,{onSubmit:Z.createOrder},{default:(0,a.w5)((({errors:e})=>[(0,a._)("div",X,[ee,(0,a.Wm)(pe,{type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["姓名"]}]),id:"name",placeholder:"請輸入姓名",modelValue:q.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=e=>q.form.user.name=e),name:"姓名",rules:"required"},null,8,["modelValue","class"]),(0,a.Wm)(be,{name:"姓名",class:"invalid-feedback"})]),(0,a._)("div",te,[se,(0,a.Wm)(pe,{type:"email",class:(0,l.C_)(["form-control",{"is-invalid":e["email"]}]),id:"email",placeholder:"example@email.com",modelValue:q.form.user.email,"onUpdate:modelValue":t[3]||(t[3]=e=>q.form.user.email=e),name:"email",rules:"email|required"},null,8,["modelValue","class"]),(0,a.Wm)(be,{name:"email",class:"invalid-feedback"})]),(0,a._)("div",ae,[le,(0,a.Wm)(pe,{type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["電話"]}]),id:"tel",placeholder:"09xxxxxxxx",modelValue:q.form.user.tel,"onUpdate:modelValue":t[4]||(t[4]=e=>q.form.user.tel=e),name:"電話",rules:Z.isPhone},null,8,["modelValue","class","rules"]),(0,a.Wm)(be,{name:"電話",class:"invalid-feedback"})]),(0,a._)("div",ne,[oe,(0,a.Wm)(pe,{type:"text",class:(0,l.C_)(["form-control",{"is-invalid":e["地址"]}]),id:"address",placeholder:"請輸入地址",modelValue:q.form.user.address,"onUpdate:modelValue":t[5]||(t[5]=e=>q.form.user.address=e),name:"地址",rules:"required"},null,8,["modelValue","class"]),(0,a.Wm)(be,{name:"地址",class:"invalid-feedback"})]),(0,a._)("div",de,[ie,(0,a.wy)((0,a._)("textarea",{type:"text",class:"form-control",id:"message",rows:"4",placeholder:"請輸入想說的話","onUpdate:modelValue":t[6]||(t[6]=e=>q.form.message=e)},null,512),[[n.nr,q.form.message]])]),(0,a._)("div",re,[(0,a._)("button",{type:"submit",class:"btn btn-dark w-100",disabled:Object.keys(e).length>0}," 送出訂單 ",8,ce)])])),_:1},8,["onSubmit"])])])])],64)):((0,a.wg)(),(0,a.iD)("div",me,he)),(0,a.Wm)(_e,{item:q.itemTemp,onDelItem:Z.delItem,ref:"delModal"},null,8,["item","onDelItem"])])],64)}var fe=s(9868),_e=s(7424),ge=s.n(_e),ye=s(3181),ve=s(1630),xe={components:{DelModal:ye.Z,Loader:ve.Z},data(){return{cart:{carts:[]},form:{user:{name:"",email:"",tel:"",address:""},message:""},coupon:"",itemTemp:{},delModal:{},isLoading:!0}},methods:{getCart(){const e="https://vue3-course-api.hexschool.io/v2/api/yunei/cart";this.isLoading=!0,this.$http.get(e).then((e=>{this.isLoading=!1,this.cart=e.data.data})).catch((e=>{this.$httpMessageState(e.response,e.response.data.message)}))},useCoupon(){const e="https://vue3-course-api.hexschool.io/v2/api/yunei/coupon",t={data:{code:this.coupon}};this.$http.post(e,t).then((e=>{this.getCart(),this.$httpMessageState(e,"套用優惠券")})).catch((e=>{this.$httpMessageState(e.response,e.response.data.message)}))},createOrder(){const e="https://vue3-course-api.hexschool.io/v2/api/yunei/order",t={data:this.form};this.$http.post(e,t).then((e=>{this.$router.push(`/checkout/${e.data.orderId}`),fe.Z.emit("get-cart")})).catch((e=>{this.$httpMessageState(e.response,e.response.data.message)}))},openDelModal(e){this.itemTemp=e,this.delModal.show()},delItem(){const e=`https://vue3-course-api.hexschool.io/v2/api/yunei/cart/${this.itemTemp.id}`;this.$http.delete(e).then((e=>{this.delModal.hide(),this.$httpMessageState(e,`將 ${this.itemTemp.product.title} 刪除`),this.getCart(),fe.Z.emit("get-cart")})).catch((e=>{this.$httpMessageState(e.response,e.response.data.message)}))},modifyQty(e,t){"add"===e?t.qty+=1:"sub"===e&&(t.qty-=1),""===t.qty?t.qty=1:0===t.qty?(this.openDelModal(t),t.qty=1):t.qty%1&&(t.qty=parseInt(t.qty));const s=`https://vue3-course-api.hexschool.io/v2/api/yunei/cart/${t.id}`,a={data:{product_id:t.id,qty:t.qty}};this.$http.put(s,a).then((e=>{this.$httpMessageState(e,`更新 ${t.product.title} 數量`),fe.Z.emit("get-cart")})).catch((e=>{this.$httpMessageState(e.response,e.response.data.message)}))},isPhone(e){const t=/^(09)[0-9]{8}$/;return!!t.test(e)||"電話 須為有效的電話號碼"}},mounted(){this.delModal=new(ge())(this.$refs.delModal.modal),this.getCart(),fe.Z.on("get-check-order",(()=>{this.getCart()}))}},ke=s(3744);const we=(0,ke.Z)(xe,[["render",be]]);var Ce=we},71:function(e,t,s){e.exports=s.p+"img/daoru-logo02.79d17a46.png"}}]);
//# sourceMappingURL=57.4894bed5.js.map