"use strict";(self["webpackChunkvue_final"]=self["webpackChunkvue_final"]||[]).push([[760],{1407:function(e,t,a){a.d(t,{Z:function(){return b}});var o=a(6252),n=a(3577),s=a(9963);const i={"aria-label":"Page navigation example"},l={class:"pagination"},p=(0,o._)("span",{"aria-hidden":"true"},"«",-1),d=[p],c=["onClick"],u=(0,o._)("span",{"aria-hidden":"true"},"»",-1),r=[u];function h(e,t,a,p,u,h){return(0,o.wg)(),(0,o.iD)("nav",i,[(0,o._)("ul",l,[(0,o._)("li",{class:(0,n.C_)(["page-item",{disabled:!a.pagination.has_pre}])},[(0,o._)("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=(0,s.iM)((e=>h.updateList(a.pagination.current_page-1)),["prevent"]))},d)],2),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.pagination.total_pages,(e=>((0,o.wg)(),(0,o.iD)("li",{key:e,class:"page-item",href:"#"},[(0,o._)("a",{class:"page-link",onClick:(0,s.iM)((t=>h.updateList(e)),["prevent"])},(0,n.zw)(e),9,c)])))),128)),(0,o._)("li",{class:(0,n.C_)(["page-item",{disabled:!a.pagination.has_next}])},[(0,o._)("a",{class:"page-link",href:"#","aria-label":"Next",onClick:t[1]||(t[1]=(0,s.iM)((e=>h.updateList(a.pagination.current_page+1)),["prevent"]))},r)],2)])])}var m={props:["pagination"],methods:{updateList(e){this.$emit("get-data",e)}}},_=a(3744);const g=(0,_.Z)(m,[["render",h]]);var b=g},2760:function(e,t,a){a.r(t),a.d(t,{default:function(){return pe}});var o=a(6252),n=a(3577),s=a(9963);const i={class:"container py-4"},l=(0,o._)("h2",null,"優惠券",-1),p={class:"text-end"},d={class:"table table-hover mt-3 align-middle"},c=(0,o._)("thead",null,[(0,o._)("th",null,"名稱"),(0,o._)("th",null,"折扣代碼"),(0,o._)("th",{class:"text-center"},"折扣"),(0,o._)("th",{class:"text-center"},"期限"),(0,o._)("th",{class:"text-center"},"啟用"),(0,o._)("th",{class:"text-center"},"編輯")],-1),u={class:"ps-0"},r={class:"ps-0"},h={class:"text-center"},m={class:"text-center"},_={class:"text-center"},g={class:"form-check form-switch d-flex justify-content-center"},b=["id","onUpdate:modelValue","onChange"],f=["for"],v={key:0},w={key:1},T={class:"text-center"},k=["onClick"],y=["onClick"];function C(e,t,a,C,M,x){const D=(0,o.up)("Loading"),$=(0,o.up)("Pagination"),L=(0,o.up)("CouponModal"),V=(0,o.up)("DelModal");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(D,{active:M.isLoading,loader:"dots","z-index":1e3},null,8,["active"]),(0,o._)("div",i,[l,(0,o._)("div",p,[(0,o._)("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=e=>x.openModal("new"))}," + 新增優惠券 ")]),(0,o._)("table",d,[c,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(M.coupons,(e=>((0,o.wg)(),(0,o.iD)("tr",{key:e.id},[(0,o._)("td",u,(0,n.zw)(e.title),1),(0,o._)("td",r,(0,n.zw)(e.code),1),(0,o._)("td",h,(0,n.zw)(e.percent/10)+" 折",1),(0,o._)("td",m," ~ "+(0,n.zw)(new Date(1e3*e.due_date).toLocaleDateString()),1),(0,o._)("td",_,[(0,o._)("div",g,[(0,o.wy)((0,o._)("input",{class:"form-check-input me-1",type:"checkbox",role:"switch",id:e.id,"onUpdate:modelValue":t=>e.is_enabled=t,"true-value":1,"false-value":0,onChange:t=>x.updateIsEnabled(e)},null,40,b),[[s.e8,e.is_enabled]]),(0,o._)("label",{class:"form-check-label",for:e.id},[e.is_enabled?((0,o.wg)(),(0,o.iD)("span",v,"啟用")):((0,o.wg)(),(0,o.iD)("span",w,"不啟用"))],8,f)])]),(0,o._)("td",T,[(0,o._)("button",{type:"button",class:"btn btn-primary me-1",onClick:t=>x.openModal("edit",e)}," 編輯 ",8,k),(0,o._)("button",{type:"button",class:"btn btn-outline-danger",onClick:t=>x.openModal("del",e)}," 刪除 ",8,y)])])))),128))])]),(0,o.Wm)($,{pagination:M.pagination,onGetData:x.getCoupons},null,8,["pagination","onGetData"]),(0,o.Wm)(L,{coupon:M.couponTemp,"is-new":M.isNew,onUpdateCoupon:x.updateCoupon,ref:"couponModal"},null,8,["coupon","is-new","onUpdateCoupon"]),(0,o.Wm)(V,{item:M.couponTemp,onDelItem:x.delCoupon,ref:"delModal"},null,8,["item","onDelItem"])])],64)}var M=a(7424),x=a.n(M),D=a(1407);const $={class:"modal",tabindex:"-1",ref:"modal"},L={class:"modal-dialog"},V={class:"modal-content"},S={class:"modal-header bg-dark"},W={class:"modal-title text-white"},N={key:0},U={key:1},z=(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Z={class:"modal-body"},I={class:"mb-3"},P=(0,o._)("label",{for:"title",class:"form-label"},"名稱",-1),q={class:"mb-3"},H=(0,o._)("label",{for:"code",class:"form-label"},"優惠碼",-1),Y={class:"mb-3"},j=(0,o._)("label",{for:"percent",class:"form-label"},"折扣",-1),E={class:"mb-3"},F=(0,o._)("label",{for:"due_date",class:"form-label"},"期限",-1),G={class:"form-check form-switch"},K=["for"],O={key:0},A={key:1},B={class:"modal-footer"},J=(0,o._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Q=["disabled"],R={key:0},X={key:1};function ee(e,t,a,i,l,p){const d=(0,o.up)("Field"),c=(0,o.up)("error-message"),u=(0,o.up)("Form");return(0,o.wg)(),(0,o.iD)("div",$,[(0,o._)("div",L,[(0,o._)("div",V,[(0,o._)("div",S,[(0,o._)("h5",W,[a.isNew?((0,o.wg)(),(0,o.iD)("span",N,"新增優惠券")):((0,o.wg)(),(0,o.iD)("span",U,"編輯優惠券"))]),z]),(0,o.Wm)(u,{onSubmit:p.updateCoupon},{default:(0,o.w5)((({errors:e})=>[(0,o._)("div",Z,[(0,o._)("div",I,[P,(0,o.Wm)(d,{type:"text",class:(0,n.C_)(["form-control",{"is-invalid":e["優惠券名稱"]}]),id:"title",placeholder:"請輸入優惠券名稱",modelValue:l.couponTemp.title,"onUpdate:modelValue":t[0]||(t[0]=e=>l.couponTemp.title=e),name:"優惠券名稱",rules:"required"},null,8,["modelValue","class"]),(0,o.Wm)(c,{name:"優惠券名稱",class:"invalid-feedback"})]),(0,o._)("div",q,[H,(0,o.Wm)(d,{type:"text",class:(0,n.C_)(["form-control",{"is-invalid":e["優惠碼"]}]),id:"code",placeholder:"請輸入優惠碼",modelValue:l.couponTemp.code,"onUpdate:modelValue":t[1]||(t[1]=e=>l.couponTemp.code=e),name:"優惠碼",rules:"required"},null,8,["modelValue","class"]),(0,o.Wm)(c,{name:"優惠碼",class:"invalid-feedback"})]),(0,o._)("div",Y,[j,(0,o.Wm)(d,{type:"number",min:"0",max:"100",class:(0,n.C_)(["form-control",{"is-invalid":e["折扣百分比"]}]),id:"percent",placeholder:"請輸入折扣百分比",modelValue:l.couponTemp.percent,"onUpdate:modelValue":t[2]||(t[2]=e=>l.couponTemp.percent=e),modelModifiers:{number:!0},name:"折扣百分比",rules:"required|min_value:0|max_value:100"},null,8,["modelValue","class"]),(0,o.Wm)(c,{name:"折扣百分比",class:"invalid-feedback"})]),(0,o._)("div",E,[F,(0,o.wy)((0,o._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[3]||(t[3]=e=>l.due_date=e)},null,512),[[s.nr,l.due_date]])]),(0,o._)("div",G,[(0,o.wy)((0,o._)("input",{class:"form-check-input me-1",type:"checkbox",role:"switch",id:"couponTemp.id","onUpdate:modelValue":t[4]||(t[4]=e=>l.couponTemp.is_enabled=e),"true-value":1,"false-value":0},null,512),[[s.e8,l.couponTemp.is_enabled]]),(0,o._)("label",{class:"form-check-label",for:l.couponTemp.id},[l.couponTemp.is_enabled?((0,o.wg)(),(0,o.iD)("span",O,"啟用")):((0,o.wg)(),(0,o.iD)("span",A,"不啟用"))],8,K)])]),(0,o._)("div",B,[J,(0,o._)("button",{type:"submit",class:"btn btn-primary",disabled:Object.keys(e).length>0},[a.isNew?((0,o.wg)(),(0,o.iD)("span",R,"新增")):((0,o.wg)(),(0,o.iD)("span",X,"儲存"))],8,Q)])])),_:1},8,["onSubmit"])])])],512)}var te={props:["coupon","isNew"],data(){return{couponTemp:{is_enabled:0},due_date:"",modal:{}}},watch:{coupon(){this.couponTemp=this.coupon,this.due_date=new Date(1e3*this.couponTemp.due_date).toISOString().split("T")[0]},due_date(){this.couponTemp.due_date=new Date(this.due_date).getTime()/1e3}},methods:{updateCoupon(){this.$emit("update-coupon",this.couponTemp)},percentLimit(){this.couponTemp.percent>100?this.couponTemp.percent=100:this.couponTemp.percent<0&&(this.couponTemp.percent=0)}},mounted(){this.modal=this.$refs.modal}},ae=a(3744);const oe=(0,ae.Z)(te,[["render",ee]]);var ne=oe,se=a(3181),ie={components:{Pagination:D.Z,CouponModal:ne,DelModal:se.Z},data(){return{coupons:[],pagination:{},couponTemp:{is_enabled:0},due_date:"",couponModal:{},delModal:{},isNew:!0,isLoading:!1}},watch:{due_date(){this.couponTemp.due_date=new Date(this.due_date).getTime()/1e3}},methods:{getCoupons(e=1){const t=`https://vue3-course-api.hexschool.io/v2/api/yunei/admin/coupons?page=${e}`;this.isLoading=!0,this.$http.get(t).then((e=>{this.isLoading=!1,this.coupons=e.data.coupons,this.pagination=e.data.pagination})).catch((e=>{this.$httpMessageState(e.response,e.response.data.message),this.isLoading=!1}))},openModal(e,t){"new"===e?(this.isNew=!0,this.couponTemp={is_enabled:0,due_date:(new Date).getTime()/1e3},this.couponModal.show()):"edit"===e?(this.isNew=!1,this.couponTemp={...t},this.couponModal.show()):"del"===e&&(this.couponTemp={...t},this.delModal.show())},updateCoupon(){let e=`https://vue3-course-api.hexschool.io/v2/api/yunei/admin/coupon/${this.couponTemp.id}`,t="put",a=`更新 ${this.couponTemp.title} 優惠券`;this.isNew&&(e="https://vue3-course-api.hexschool.io/v2/api/yunei/admin/coupon",t="post",a=`新增 ${this.couponTemp.title} 優惠券`),this.$http[t](e,{data:this.couponTemp}).then((e=>{this.getCoupons(this.pagination.current_page),this.couponModal.hide(),this.$httpMessageState(e,a)})).catch((e=>{this.$httpMessageState(e.response,e.response.data.message)}))},updateIsEnabled(e){this.couponTemp={...e};const t=`https://vue3-course-api.hexschool.io/v2/api/yunei/admin/coupon/${this.couponTemp.id}`;this.isLoading=!0,this.$http.put(t,{data:this.couponTemp}).then((e=>{this.isLoading=!1,this.$httpMessageState(e,`更新 ${this.couponTemp.title} 優惠券`)})).catch((e=>{this.isLoading=!1,this.$httpMessageState(e.response,e.response.data.message),this.getCoupons(this.pagination.current_page)}))},delCoupon(e){const t=`https://vue3-course-api.hexschool.io/v2/api/yunei/admin/coupon/${this.couponTemp.id}`;this.$http.delete(t,{data:e}).then((e=>{this.$httpMessageState(e,`刪除 ${this.couponTemp.title} 優惠券`),this.delModal.hide(),this.getCoupons(this.pagination.current_page)})).catch((e=>{this.$httpMessageState(e.response,e.response.data.message),this.delModal.hide()}))}},mounted(){this.getCoupons(),this.couponModal=new(x())(this.$refs.couponModal.modal),this.delModal=new(x())(this.$refs.delModal.modal)}};const le=(0,ae.Z)(ie,[["render",C]]);var pe=le}}]);
//# sourceMappingURL=760.206db2fb.js.map